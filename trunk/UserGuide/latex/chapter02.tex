% chapter02.tex

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                           %
 %    PyMS documentation                                                     %
 %    Copyright (C) 2005-8 Vladimir Likic                                    %
 %                                                                           %
 %    The files in this directory provided under the Creative Commons        %
 %    Attribution-NonCommercial-NoDerivs 2.1 Australia license               %
 %    http://creativecommons.org/licenses/by-nc-nd/2.1/au/                   %
 %    See the file license.txt                                               %
 %                                                                           %
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Using PyMS}

\section{Introduction}

This chapter gives examples of PyMS use. The commands used in the examples
are collected into scripts and saved in the project 'pyms-test'.  Each example
subsection given below has a corresponding directory in 'pyms-test'. The
project 'pyms-data' contains data files used in all examples. Both 'pyms-data'
and 'pyms-test' are downloadable from Google Code.

The setup used for the examples below is as follows. The projects 'pyms',
'pyms-data', and 'pyms-test' were all downloaded in the directory
{\tt /home/current/proj/PyMS}. In each example the Python interpreter
was made aware of the PyMS location with the following commands:

\begin{verbatim}
>>> import sys
>>> sys.path.append("/home/current/proj/PyMS/")
\end{verbatim}

For brevity these commands will not be shown in the examples below.

Each example was run from the corresponding sub-directory of 'pyms-test':
Example 1 was run in {\tt pyms-test/example01}, and so on.

\section{PyMS examples}

\subsection{Example 1: Reading GC-MS data exported from Agilent ChemStation}

The PyMS package pyms.IO provides capabilities to read the raw GC-MS
data stored in the ANDI-MS format. The function IO.ANDI.ChemStation()
provides the interface to ANDI-MS data files saved from Agilent
ChemStation software. The name is a reminder that this function has
been tested only on the data exported from Agilent ChemStation.

ANDI-MS data format stands for Analytical Data Interchange for Mass
Spectrometry, and was developed for the description of mass spectrometric
data developed in 1994 by Analytical Instrument Association. ANDI-MS 
is essentially a recommendation, and it is up to individual vendors of
mass spectrometry processing software to implement "export to ANDI-MS"
feature in their software. Furthermore, it is vendor's good will to
implement ANDI-MS specifications properly. Because of these limitations
one cannot be certain that one can properly read ANDI-MS files from
a particular vendor without testing this first.

The file '0510\_217.CDF' is a GC-MS experiment exported from Agilent
ChemStation (located in 'pyms-data'). This file can be loaded in the
memory as follows:

\begin{verbatim}
>>> from pyms.IO.ANDI.Class import ChemStation
>>> andi_file = "/home/current/proj/PyMS/pyms-data/0510_217.CDF"
>>> data = ChemStation(andi_file)
 -> Processing netCDF file '/home/current/proj/PyMS/pyms-data/0510_217.CDF'
    [ 2784 scans, masses from 50 to 550 ]
>>>
\end{verbatim}

\noindent
The above command creates the object 'data' which is an {\em instance}
of the class IO.ANDI.ChemStation.  The instance 'data' has several
attributes and methods associated with it.

\subsection{Example 2: Exploring data attributes}

To load the data:

\begin{verbatim}
>>> from pyms.IO.ANDI.Class import ChemStation
>>> andi_file = "/home/current/proj/PyMS/pyms-data/0510_217.CDF"
>>> data = ChemStation(andi_file)
\end{verbatim}

The method {\tt get\_filename()} returns the name of the file from which
the data was loaded. Usage example:

\begin{verbatim}
>>> print data.get_filename()
/home/current/proj/PyMS/pyms-data/0510_217.CDF
\end{verbatim}

The method {\tt get\_ic\_at\_index(i)} returns an IonChromatogram object
at index i. For example, to get the first ion chromatogram from the data
matrix:

\begin{verbatim}
>>> ic = data.get_ic_at_index(1)
\end{verbatim}

\noindent
An IonChromatogram object is the one dimensional time vector containing
mass intensities as a function of retention time.

An ion chromatogram is a set of intensities as a function of retention
time. This can can be either m/z channel intensities (for example, ion
chromatograms at m/z = 65), or cumulative intensities over all measured
m/z. In the latter case the ion chromatogram is total ion chromatogram
(TIC).

The nature of an IonChromatogram object can be revealed by calling
the method .is\_tic():

\begin{verbatim}
>>> print ic.is_tic()
False
\end{verbatim}

\noindent
This shows that the first ion chromatogram in the data file is for
m/z = 51.

\begin{verbatim}
>>> tic = data.get_tic()
>>> print tic.is_tic()
True
\end{verbatim}

\noindent
This shows the method to obtain a TIC from the data. Note that both
'ic' and 'tic' are instances of the IonChromatogram class.

The method {\tt get\_ic\_at\_mass(mz)} returns an IonChromatogram
object corresponding to given m/z. For example, to get the ion
chromatogram that corresponds to m/z = 73:

\begin{verbatim}
>>> ic = data.get_ic_at_mass(73)
>>> print ic.is_tic()
False
\end{verbatim}

The method {\tt get\_intensity\_matrix()} returns the entire matrix of
intensities:

\begin{verbatim}
>>> im = data.get_intensity_matrix()
>>> print len(im)
2784
>>> print len(im[0])
501
\end{verbatim}

This data matrix contains 2784 time points (MS scans), and each time point
corresponds to a mass spectrum of 501 m/z points.


