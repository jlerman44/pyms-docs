% chapter02.tex

 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                           %
 %    PyMS documentation                                                     %
 %    Copyright (C) 2005-8 Vladimir Likic                                    %
 %                                                                           %
 %    The files in this directory provided under the Creative Commons        %
 %    Attribution-NonCommercial-NoDerivs 2.1 Australia license               %
 %    http://creativecommons.org/licenses/by-nc-nd/2.1/au/                   %
 %    See the file license.txt                                               %
 %                                                                           %
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Fundamental data structures}

\section{GC-MS Data Model}

PyMS can read gas chromatography-mass spectrometry (GC-MS) data stored in
Analytical Data Interchange for Mass Spectrometry (ANDI-MS),\footnote{ANDI-MS
was developed by the Analytical Instrument Association.} and Joint Committee on
Atomic and Molecular Physical Data (JCAMP-DX)\footnote{JCAMP-DX is maintained by
the International Union of Pure and Applied Chemistry.} formats. These formats
are essentially recommendations, and it is up to individual vendors of mass
spectrometry processing software to implement ``export to ANDI-MS'' or ``export
to JCAMP-DX'' features in their software. It is also possible to get third party
converters. The information contained in the exported data files
can vary significantly, depending on the instrument, vendor's software, or
conversion utility.

For PyMS, the minimum set of assumptions about the information contained in the
data file are:
\begin{itemize}
    \item The data contain the mz and intensity value pairs across a scan.
    \item Each scan has a retention time.
\end{itemize}

Internally, PyMS stores the raw data from ANDI files or JCAMP files as a
GCMS\_data object. Once a GCMS\_data object has been created, the raw data can
not be modified. The operations (methods) available are illustrated in the
following sections.

\section{Reading GCMS data}

This section demonstrates the GCMS data reading functions of PyMS in a tutorial
like manner. The data files used in the examples are provided in the project
`pyms-data'. The commands executed interactively are grouped together by
example, and provided as Python scripts in the project `pyms-test'.

The setup used in the examples below is as follows. The projects `pyms',
`pyms-test', `pyms-docs', and `data' are all in the same directory,
`/x/PyMS'. In the project `pyms-test' there is a directory corresponding to
each example coded with the example number (ie. {\tt pyms-test/01a/}
corresponds to Example 1a). In each example directory, there is a script named
`proc.py' which contains the commands given in the example. Provided that the
paths to `pyms' and `pyms-data' are set properly, these scripts could be run
with the following command:

\begin{verbatim}
$ python proc.py
\end{verbatim}

Before running each example the Python interpreter was made aware of the
PyMS location with the following commands:

\begin{verbatim}
import sys
sys.path.append("/x/PyMS/pyms")
\end{verbatim}

For brevity these commands will not be shown in the examples below, but
they are included in `pyms-test' example scripts.  The above path may need
to be adjusted to match your own directory structure.

All data files (raw data files, peak lists etc.) used in the example below
can be found at {\tt http://bioinformatics.bio21.unimelb.edu.au/pyms/data/} and
are assumed to be located in the `data' directory.

\subsection{Reading JCAMP GC-MS data into PyMS}

\noindent
[ {\em This example is in pyms-test/20a} ]

The PyMS package pyms.GCMS.IO.JCAMP provides capabilities to read the raw
GC-MS data stored in the JCAMP-DX format.

The file `gc01\_0812\_066.jdx' (located in `data') is a GC-MS experiment
converted from Agilent ChemStation format to JCAMP format using File
Translator Pro.\footnote{ChemSW, Inc.} This file can be loaded in Python
as follows:

\begin{verbatim}
>>> from pyms.GCMS.IO.JCAMP.Function import JCAMP_reader
>>> jcamp_file = "/x/PyMS/data/gc01_0812_066.jdx"
>>> data = JCAMP_reader(jcamp_file)
 -> Reading JCAMP file '/x/PyMS/pyms-data/gc01_0812_066.jdx'
>>>
\end{verbatim}

\noindent
The above command creates the object `data' which is an {\em instance}
of the class GCMS\_data.

\subsection{Reading ANDI GC-MS data into PyMS}

\noindent
[ {\em This example is in pyms-test/20b} ]

The PyMS package pyms.GCMS.IO.ANDI provides capabilities to read the raw
GC-MS data stored in the ANDI-MS format.

The file `gc01\_0812\_066.cdf' (located in `data') is a GC-MS experiment
converted to ANDI-MS format from Agilent ChemStation (from the same data as in
example 01a above). This file can be loaded as follows:

\begin{verbatim}
>>> from pyms.GCMS.IO.ANDI.Functions import ANDI_reader
>>> ANDI_file = "/x/PyMS/data/gc01_0812_066.cdf"
>>> data = ANDI_reader(ANDI_file)
 -> Reading netCDF file '/x/PyMS/pyms-data/gc01_0812_066.cdf'
>>>
\end{verbatim}

\noindent
The above command creates the object `data' which is an {\em instance}
of the class GCMS\_data.

\subsection{Exploring a GCMS data object}

\noindent
[ {\em The following examples are the same in pyms-test/20a and pyms-test/20b} ]

The object `data' (from the two previous examples) stores the raw data as a {\em
GCMS\_data} object. Within the GCMS\_data object, raw data are stored as a list
of {\em Scan} objects and a list of retention times.  There are several methods
available to access data and attributes of the GCMS\_data and Scan objects.

The GCMS\_data object's methods relate to the raw data. The main properties
relate to the masses, retention times and scans. For example, the
minimum and maximum mass from all of the raw data can be returned by the
following:

\begin{verbatim}
>>> data.get_min_mass()
>>> data.get_max_mass()
\end{verbatim}

A list of all retention times can be returned by:

\begin{verbatim}
>>> time = data.get_time_list()
\end{verbatim}

The index of a specific retention time (in seconds) can returned by:

\begin{verbatim}
>>> data.get_index_at_time(400.0)
\end{verbatim}

\noindent
Note that this returns the index of the retention time in the
data closest to the given retention time (400.0 seconds).

The method {\tt get\_tic()} returns a total ion chromatogram (TIC) of the data
as an IonChromatogram object:

\begin{verbatim}
tic = data.get_tic()
\end{verbatim}

\noindent
The IonChromatogram object is covered in a later section.

A list of all the raw Scan objects can be returned by:

\begin{verbatim}
>>> scans = data.get_scan_list()
\end{verbatim}

\noindent
The Scan object has methods relating to an individual scan. This is covered in
the next section.

\subsection {Exploring a Scan data object}

\noindent
[ {\em The following examples are the same in pyms-test/01a and pyms-test/01b} ]

A Scan object contains a list of masses and a corresponding list of intensity
values from a single mass-spectrum scan.

A list of all masses in a scan (e.g. the 1st scan) is returned by:

\begin{verbatim}
>>> scans[0].get_mass_list()
\end{verbatim}

A list of all corresponding intensities in a scan is returned by:

\begin{verbatim}
>>> scans[0].get_intensity_list()
\end{verbatim}

The maximum and minimum mass in an individual scan (e.g. the 1st scan) are
returned by:

\begin{verbatim}
>>> scans[0].get_min_mass()
>>> scans[0].get_max_mass()
\end{verbatim}

